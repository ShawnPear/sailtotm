<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yasyl.sailtotm.infra.dal.dao.SearchKeywordsHistoryDao">
    <insert id="insert">
        INSERT INTO SearchKeywordsHistory (user_id, keyword, cnt, ctime, utime)
        VALUES (#{userId},
                #{keyword},
                #{1},
                unix_timestamp(),
                unix_timestamp());
    </insert>
    
    <update id="update">
        UPDATE SearchKeywordsHistory
        SET cnt = cnt + 1,utime = unix_timestamp()
        WHERE user_id = #{userId} AND keyword = #{keyword};
    </update>
    
    <select id="queryByUserId" resultType="com.yasyl.sailtotm.infra.dal.entity.SearchKeywordsHistory">
        SELECT user_id as userId,keyword as keyword,cnt as cnt,ctime as ctime,utime as utime
        FROM SearchKeywordsHistory
        WHERE user_id = #{userId}
        ORDER BY cnt
        LIMIT #{size}
    </select>
    
    <select id="queryByUserIdAndKeyword" resultType="com.yasyl.sailtotm.infra.dal.entity.SearchKeywordsHistory">
        SELECT user_id as userId,keyword as keyword,cnt as cnt,ctime as ctime,utime as utime
        FROM SearchKeywordsHistory
        WHERE user_id = #{userId} AND keyword = #{keyword}
    </select>
</mapper>